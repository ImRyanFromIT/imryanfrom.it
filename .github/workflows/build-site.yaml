name: Website Integrate and Deploy

on:
    push:
        branches:
            - master
    workflow_dispatch:

jobs:
    pull:
      runs-on: [GV-DATA01]
      # Updates repo on file server
      # triggering a push
      steps:
        - name: Pull repo
          run: |
            pushd \\gv-data01\Shares\WebShare\imryanfrom.it 
            git pull origin master
            popd
          shell: cmd

    build:
      runs-on: [GV-DATA01]
      needs: pull

      steps:
      # checkout to the commit that has been pushed
      - uses: actions/checkout@v3

      - name: Update Hugo modules
        run: |
          pushd \\gv-data01\Shares\WebShare\imryanfrom.it 
          hugo mod tidy
          popd
        shell: cmd

      - name: Install node modules
        run: |
          pushd \\gv-data01\Shares\WebShare\imryanfrom.it 
          hugo mod npm pack
          npm install
          popd
        shell: cmd
          
      - name: Build the website
        run: |
          pushd \\gv-data01\Shares\WebShare\imryanfrom.it
          hugo --minify
          popd
        shell: cmd